<!DOCTYPE html>
<html>

<head>
    <title>Congressional Committee Maps</title>
    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
      <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>

    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/foundation.css" />

    <!-- custom css -->
    <link rel="stylesheet" href="css/style.css" />

    <script src="maps/gz_2010_us_040_00_20m.js"></script>
    <script src="maps/gz_2010_us_500_11_20m.js"></script>
    <script src="js/vendor/custom.modernizr.js"></script>
    <script src="js/foundation/foundation.js"></script>
    <script src="js/foundation/foundation.dropdown.js"></script>
    <script src="js/helperFunctions.js"></script>

</head>

<body>
<script>
    $(document)
            .foundation();
</script>
<div class="row">
    <div class="large-12 columns">

        <h1><small>Congressional Committee Maps</small></h1>
    </div>
</div>

<!-- End Nav -->


<!-- Main Page Content and Sidebar -->

<div class="row">

    <!-- Main Content -->
    <div class="large-9 columns" role="content">

        <section>
            <div class="large-12 columns">
                <a href="#" class="button" data-dropdown="tinyDropHouse">House Committees &raquo;</a>
                <ul id="tinyDropHouse" class="f-dropdown" data-dropdown-content="" style="position: absolute; top: 230px; left: -99999px;">
                    <li><a href="#">This is a link</a>
                    </li>
                    <li><a href="#">This is another</a>
                    </li>
                    <li><a href="#">Yet another</a>
                    </li>
                </ul>
                <a href="#" class="button" data-dropdown="tinyDropSenate">Senate Committees &raquo;</a>
                <ul id="tinyDropSenate" class="f-dropdown" data-dropdown-content="" style="position: absolute; top: 230px; left: -99999px;">
                    <li><a href="#">This is a link</a>
                    </li>
                    <li><a href="#">This is another</a>
                    </li>
                    <li><a href="#">Yet another</a>
                    </li>
                </ul>
                <a href="#" class="button" data-dropdown="tinyDropJoint">Joint Committees &raquo;</a>
                <ul id="tinyDropJoint" class="f-dropdown" data-dropdown-content="" style="position: absolute; top: 230px; left: -99999px;">
                    <li><a href="#">This is a link</a>
                    </li>
                    <li><a href="#">This is another</a>
                    </li>
                    <li><a href="#">Yet another</a>
                    </li>
                </ul>

            </div>
            <div class="row">

                <div class="large-12 columns" id="map">
                </div>
            </div>

        </section>


    </div>

    <!-- End Main Content -->


    <!-- Sidebar -->

    <aside class="large-3 columns">
        <div class="panel">
            <h5>Featured</h5>
            <p>Click a district or member for detail.</p>
        </div>
        <h5>Committee Members</h5>
        <ul class="side-nav">
            <li><a href="#">Member 1</a>
            </li>
            <li><a href="#">Member 2</a>
            </li>
            <li><a href="#">Member 3</a>
            </li>
            <li><a href="#">Member 4</a>
            </li>
            <li><a href="#">Member 5</a>
            </li>
        </ul>



    </aside>

    <!-- End Sidebar -->
</div>

<!-- End Main Content and Sidebar -->


<!-- Footer -->

<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>Let me know if you use these maps: mroswell@gmail.com</p>
            </div>
            <div class="large-6 columns">
                &nbsp;
            </div>
        </div>
    </div>
</footer>

<script>
    var latitude = 39.9;
    var longitude = -98.5;
    var latLng = new L.LatLng(latitude, longitude);
    var map = L.map('map')
            .setView(latLng, 4);
    //    var marker = L.marker(latLng).addTo(map);





    // My goal is to color by values from the API call. so far, only can color by properties already in the GeoJSON file
    function style(feature) {
        console.log("you are here"+feature.properties.STATE*2);
        return {
            fillColor: getColor(feature.properties.STATE),
//            fillColor: getColor([4, '24',25,26,51]),
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
        };
    }

    var stateLayer = L.geoJson(statesMap);
    stateLayer.addTo(map);


    L.tileLayer('http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
        key: '4733d063f9704b1c940a64459b1263e9',
        styleId: 96931,
        maxZoom: 18
    })
            .addTo(map);


    var drawDistricts = function (responseData) {
        L.geoJson(congressionalMap)
                .addTo(map);
    };


    // create variable called committeeRequest that asks Congress API for the members of the
    // House Agriculture Committee

    var committeeRequest = $.ajax({
        dataType: "json",
        url: "http://congress.api.sunlightfoundation.com/committees",
        data: {
            per_page: "all",
            chamber: "senate",
            committee_id: "SSAF",
            subcommittee: false,
            fields: ["name", "committee_id", "office", "subcommittee", "phone", "url", "members"],
            apikey: "9e3e71730ae34e1ebbf4dd0e1c346c07"
        }
    });
    committeeRequest.done(function(committee){
        var members = committee.results[0].members;
        var states = {};
        for (var i = 0; i < members.length; i++) {
            var member = members[i].legislator;
            var stateName = member.state_name;
            if (!states[stateName]) {
                states[stateName] = [ member ];
            } else {
                states[stateName].push(member);
            }
        }
        stateLayer.setStyle(function(shape) {
            var match = states[shape.properties.NAME];
            if (!match) {
                return {
                    display: "none",
                    opacity: 0,
                    fillColor: "transparent"
                };
            }
            var parties = _.map(match, function(member){
                return member.party;
            });
            var hasDem = parties.indexOf("D") > -1;
            var hasRep = parties.indexOf("R") > -1;
            var color;
            if (hasDem && hasRep) {
                color = "purple";
            } else {
                if (hasDem) {
                    color = "blue";
                } else {
                    color = "red";
                }
            }
            return {
                fillColor: color,
                weight: 2,
                opacity: 1,
                color: 'white',
                dashArray: '3',
                fillOpacity: 0.7
            };
        });

    });


</script>

</body>

</html>

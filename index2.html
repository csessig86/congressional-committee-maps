<!DOCTYPE html>
<html>

<head>
    <title>Congressional Committee Maps</title>
    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>

    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css" />
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->
    <script src="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.js"></script>

    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/foundation.css" />

    <!-- custom css -->
    <link rel="stylesheet" href="css/style.css" />

    <script src="maps/gz_2010_us_040_00_20m.js"></script>
    <script src="maps/cd_dists.js"></script>
    <script src="js/vendor/custom.modernizr.js"></script>
    <script src="js/foundation/foundation.js"></script>
    <script src="js/foundation/foundation.dropdown.js"></script>
    <script src="js/helperFunctions.js"></script>

</head>

<body>
<script>
    $(document)
            .foundation();
</script>
<div class="row">
    <div class="large-12 columns">

        <h1><small>Congressional Committee Maps</small></h1>
    </div>
</div>

<!-- End Nav -->


<!-- Main Page Content and Sidebar -->

<div class="row">

    <!-- Main Content -->
    <div class="large-9 columns" role="content">

        <section>
            <div class="large-12 columns">
                <a href="#" class="button" data-dropdown="tinyDropHouse">House Committees &raquo;</a>
                <ul id="tinyDropHouse" class="f-dropdown" data-dropdown-content="" style="position: absolute; top: 230px; left: -99999px;">
                    <li><a href="javascript:void(0);" data-committee="HSAG">House Committee on Agriculture</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSAP">House Committee on Appropriations</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSAS">House Committee on Armed Services</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSBA">House Committee on Financial Services</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSBU">House Committee on the Budget</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSED">House Committee on Education and the Workforce</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSFA">House Committee on Foreign Affairs</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSGO">House Committee on Oversight and Government Reform</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSHA">House Committee on House Administration</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSHM">House Committee on Homeland Security</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSIF">House Committee on Energy and Commerce</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSII">House Committee on Natural Resources</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSJU">House Committee on the Judiciary</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSPW">House Committee on Transportation and Infrastructure</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSRU">House Committee on Rules</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSSM">House Committee on Small Business</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSSO">House Committee on Ethics</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSSY">House Committee on Science, Space, and Technology</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSVR">House Committee on Veterans' Affairs</a></li>
                    <li><a href="javascript:void(0);" data-committee="HSWM">House Committee on Ways and Means</a></li>
                    <li><a href="javascript:void(0);" data-committee="HLIG">House Permanent Select Committee on Intelligence</a></li>

                </ul>
                <a href="#" class="button" data-dropdown="tinyDropSenate">Senate Committees &raquo;</a>
                <ul id="tinyDropSenate" class="f-dropdown" data-dropdown-content="" style="position: absolute; top: 230px; left: -99999px;">

                    <li><a href="javascript:void(0);" data-committee="SSAF">Senate Committee on Agriculture, Nutrition, and Forestry</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSAP">Senate Committee on Appropriations</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSAS">Senate Committee on Armed Services</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSBK">Senate Committee on Banking, Housing, and Urban Affairs</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSBU">Senate Committee on the Budget</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSCM">Senate Committee on Commerce, Science, and Transportation</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSEG">Senate Committee on Energy and Natural Resources</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSEV">Senate Committee on Environment and Public Works</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSFI">Senate Committee on Finance</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSFR">Senate Committee on Foreign Relations</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSGA">Senate Committee on Homeland Security and Governmental Affairs</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSHR">Senate Committee on Health, Education, Labor, and Pensions</a></li>
                    <li><a href="javascript:void(0);" data-committee="SLIA">Senate Committee on Indian Affairs</a></li>

                    <li><a href="javascript:void(0);" data-committee="SSJU">Senate Committee on the Judiciary</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSRA">Senate Committee on Rules and Administration</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSSB">Senate Committee on Small Business and Entrepreneurship</a></li>
                    <li><a href="javascript:void(0);" data-committee="SSVA">Senate Committee on Veterans' Affairs</a></li>
                    <li><a href="javascript:void(0);" data-committee="SLET">Senate Select Committee on Ethics</a></li>
                    <li><a href="javascript:void(0);" data-committee="SLIN">Senate Select Committee on Intelligence</a></li>
                    <li><a href="javascript:void(0);" data-committee="SPAG">Senate Special Committee on Aging</a></li>
                    <li><a href="javascript:void(0);" data-committee="SCNC">United States Senate Caucus on International Narcotics Control</a></li>

                </ul>
                <a href="#" class="button" data-dropdown="tinyDropJoint">Joint Committees &raquo;</a>
                <ul id="tinyDropJoint" class="f-dropdown" data-dropdown-content="" style="position: absolute; top: 230px; left: -99999px;">
                    <li><a href="javascript:void(0);" data-committee="JSTX">Joint Committee on Taxation</a></li>
                    <li><a href="javascript:void(0);" data-committee="JSPR">Joint Committee on Printing</a></li>
                    <li><a href="javascript:void(0);" data-committee="JSLC">Joint Committee on the Library</a></li>
                    <li><a href="javascript:void(0);" data-committee="JSEC">Joint Economic Committee</a></li>
                    <li><a href="javascript:void(0);" data-committee="JCSE">Commission on Security and Cooperation in Europe"</a></li>
                </ul>

            </div>
            <div class="row">

                <div class="large-12 columns" id="map">
                </div>
            </div>

        </section>


    </div>

    <!-- End Main Content -->


    <!-- Sidebar -->

    <aside class="large-3 columns">
        <div class="panel">
            <h5>Featured</h5>
            <p>Click a district or member for detail.</p>
        </div>
        <h5>Committee Members</h5>
        <ul class="side-nav">
            <li><a href="#">Member 1</a>
            </li>
            <li><a href="#">Member 2</a>
            </li>
            <li><a href="#">Member 3</a>
            </li>
            <li><a href="#">Member 4</a>
            </li>
            <li><a href="#">Member 5</a>
            </li>
        </ul>



    </aside>

    <!-- End Sidebar -->
</div>

<!-- End Main Content and Sidebar -->


<!-- Footer -->

<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
                <p>Let me know if you use these maps: mroswell@gmail.com</p>
            </div>
            <div class="large-6 columns">
                &nbsp;
            </div>
        </div>
    </div>
</footer>

<script>
    var latitude = 39.9;
    var longitude = -98.5;
    var latLng = new L.LatLng(latitude, longitude);
    var map = L.map('map')
            .setView(latLng, 4);
    //    var marker = L.marker(latLng).addTo(map);





    var stateLayer = L.geoJson(congressionalDistricts);
    stateLayer.addTo(map);


    L.tileLayer('http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png', {
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
        key: '4733d063f9704b1c940a64459b1263e9',
        styleId: 96931,
        maxZoom: 18
    })
            .addTo(map);


    var drawDistricts = function (responseData) {
        L.geoJson(congressionalDistricts)
                .addTo(map);
    };


    // create variable called committeeRequest that asks Congress API for the members of the
    // House Agriculture Committee

    var drawMap= function (committee) {
        var committeeRequest = $.ajax({
            dataType: "json",
            url: "http://congress.api.sunlightfoundation.com/committees",
            data: {
                per_page: "all",
                //chamber: "house",
                committee_id: committee,
                subcommittee: false,
                fields: ["name", "committee_id", "office", "subcommittee", "phone", "url", "members"],
                apikey: "9e3e71730ae34e1ebbf4dd0e1c346c07"
            }
        });
        committeeRequest.done(function(committee){
            var members = committee.results[0].members;
            var states = {};
            for (var i = 0; i < members.length; i++) {
                var member = members[i].legislator;
                var stateName = member.state+member.district;
                if (!states[stateName]) {
                    states[stateName] = [ member ];
                } else {
                    states[stateName].push(member);
                }
            }
            console.log(states);
            stateLayer.setStyle(function(shape) {
                var abbreviation = stateName2Abbrev[stateFips2Name[shape.properties.STATE]];
                var district = parseInt(shape.properties.CD, 10);  //04 GeoJSON; 4 Congress API
                var match = states[abbreviation+district];
                if (!match) {
                    return {
                        display: "none",
                        opacity: 0,
                        fillColor: "transparent"
                    };
                }
                var parties = _.map(match, function(member){
                    return member.party;
                });
                var hasDem = parties.indexOf("D") > -1;
                var hasRep = parties.indexOf("R") > -1;
                var color;
                if (hasDem && hasRep) {
                    color = "purple";
                } else {
                    if (hasDem) {
                        color = "blue";
                    } else {
                        color = "red";
                    }
                }
                return {
                    fillColor: color,
                    weight: 1,
                    opacity: 1,
                    color: 'white',
                    dashArray: '3',
                    fillOpacity: 0.7
                };
            });

        });
    }
    //drawMap('HSAG');
    $("[data-committee]").on("click", function(e) {
        var committee = $(this).data("committee");
        drawMap(committee);
    });


</script>

</body>

</html>
